<form version="1.1" theme="dark">
  <label>Scanning and Brute-Force Detection</label>
  <fieldset submitButton="false">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Scanning By Volume</title>
      <table>
        <title>(Large Amount of Requests to Many Ports/IPs)</title>
        <search>
          <query>index=main (sourcetype=syslog ":drop_log:") OR sourcetype=pfirewall
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process&gt;\w+).*SRC=(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sDST=(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}).*PROTO=(?&lt;Protocol&gt;\w+)\sSPT=(?&lt;Source_Port&gt;\d+)\sDPT=(?&lt;Destination_Port&gt;\d+)"
| rex field=_raw "\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{2}:\d{2}\s(?&lt;Action&gt;\w+)\s(?&lt;Protocol&gt;\w+)\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Source_Port&gt;.*)\s(?&lt;Destination_Port&gt;.*)\s(?&lt;Size&gt;\d+)\s(?&lt;tcpflags&gt;.*)\s(?&lt;tcpsyn&gt;.*)\s(?&lt;tcpack&gt;.*)\s(?&lt;tcpwin&gt;.*)\s(?&lt;icmptype&gt;.*)\s(?&lt;icmpcode&gt;.*)\s(?&lt;info&gt;.*)\s(?&lt;Direction&gt;\w+)"
| stats dc(Destination_Port) as num_dport  dc(Destination_IP) as num_dip by Source_IP
| where num_dport&gt;=500 OR num_dip&gt;=10
| sort by -num_dport</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>Scanning By Volume (Top 10)</title>
      <chart>
        <search>
          <query>index=main (sourcetype=syslog ":drop_log:") OR sourcetype=pfirewall
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process&gt;\w+).*SRC=(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sDST=(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}).*PROTO=(?&lt;Protocol&gt;\w+)\sSPT=(?&lt;Source_Port&gt;\d+)\sDPT=(?&lt;Destination_Port&gt;\d+)"
| rex field=_raw "\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{2}:\d{2}\s(?&lt;Action&gt;\w+)\s(?&lt;Protocol&gt;\w+)\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Source_Port&gt;.*)\s(?&lt;Destination_Port&gt;.*)\s(?&lt;Size&gt;\d+)\s(?&lt;tcpflags&gt;.*)\s(?&lt;tcpsyn&gt;.*)\s(?&lt;tcpack&gt;.*)\s(?&lt;tcpwin&gt;.*)\s(?&lt;icmptype&gt;.*)\s(?&lt;icmpcode&gt;.*)\s(?&lt;info&gt;.*)\s(?&lt;Direction&gt;\w+)"
| timechart dc(Destination_Port) by Source_IP limit=10</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Brute Force By Volume</title>
      <table>
        <title>(Large Amount of Requests to A Single Port) (THIS WILL NOT WORK IF LINUX FWS ONLY LOG DROPPED CONNECTIONS)</title>
        <search>
          <query>index=main (sourcetype=syslog ":drop_log:") OR sourcetype=pfirewall
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process&gt;\w+).*SRC=(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sDST=(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}).*PROTO=(?&lt;Protocol&gt;\w+)\sSPT=(?&lt;Source_Port&gt;\d+)\sDPT=(?&lt;Destination_Port&gt;\d+)"
| rex field=_raw "\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{2}:\d{2}\s(?&lt;Action&gt;\w+)\s(?&lt;Protocol&gt;\w+)\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Source_Port&gt;.*)\s(?&lt;Destination_Port&gt;.*)\s(?&lt;Size&gt;\d+)\s(?&lt;tcpflags&gt;.*)\s(?&lt;tcpsyn&gt;.*)\s(?&lt;tcpack&gt;.*)\s(?&lt;tcpwin&gt;.*)\s(?&lt;icmptype&gt;.*)\s(?&lt;icmpcode&gt;.*)\s(?&lt;info&gt;.*)\s(?&lt;Direction&gt;\w+)"
| stats count as num_total by Source_IP,host,Destination_Port
| where (num_total&gt;=1000) AND Destination_Port&lt;10000 AND Destination_Port!=9997
| sort by -num_total</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>(Common Ports) Brute Force By Volume Top Ports &amp; IPs</title>
      <chart>
        <title>(THIS WILL NOT WORK IF LINUX FWS ONLY LOG DROPPED CONNECTIONS)</title>
        <search>
          <query>index=main (sourcetype=syslog ":drop_log:") OR sourcetype=pfirewall
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process&gt;\w+).*SRC=(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sDST=(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}).*PROTO=(?&lt;Protocol&gt;\w+)\sSPT=(?&lt;Source_Port&gt;\d+)\sDPT=(?&lt;Destination_Port&gt;\d+)"
| rex field=_raw "\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{2}:\d{2}\s(?&lt;Action&gt;\w+)\s(?&lt;Protocol&gt;\w+)\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Source_Port&gt;.*)\s(?&lt;Destination_Port&gt;.*)\s(?&lt;Size&gt;\d+)\s(?&lt;tcpflags&gt;.*)\s(?&lt;tcpsyn&gt;.*)\s(?&lt;tcpack&gt;.*)\s(?&lt;tcpwin&gt;.*)\s(?&lt;icmptype&gt;.*)\s(?&lt;icmpcode&gt;.*)\s(?&lt;info&gt;.*)\s(?&lt;Direction&gt;\w+)"
| where Destination_Port IN (21,22,25,110,143,80,443,3306,8000,8080)    
| timechart count(Destination_Port) by Destination_Port
| append 
    [search (sourcetype=syslog ":drop_log:") OR sourcetype=pfirewall
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process&gt;\w+).*SRC=(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sDST=(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}).*PROTO=(?&lt;Protocol&gt;\w+)\sSPT=(?&lt;Source_Port&gt;\d+)\sDPT=(?&lt;Destination_Port&gt;\d+)"
    | rex field=_raw "\d{4}-\d{1,2}-\d{1,2}\s\d{1,2}:\d{2}:\d{2}\s(?&lt;Action&gt;\w+)\s(?&lt;Protocol&gt;\w+)\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Destination_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\s(?&lt;Source_Port&gt;.*)\s(?&lt;Destination_Port&gt;.*)\s(?&lt;Size&gt;\d+)\s(?&lt;tcpflags&gt;.*)\s(?&lt;tcpsyn&gt;.*)\s(?&lt;tcpack&gt;.*)\s(?&lt;tcpwin&gt;.*)\s(?&lt;icmptype&gt;.*)\s(?&lt;icmpcode&gt;.*)\s(?&lt;info&gt;.*)\s(?&lt;Direction&gt;\w+)"
    | where Destination_Port IN (21,22,25,110,143,80,443,3306,8000,8080)
    | timechart count by Source_IP]</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">1</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">10.25.100.110,10.25.100.111,127.0.0.1,192.168.150.12</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Brute Force by Auth Logs</title>
      <table>
        <title>(SSH Confirmed  Works IDK About Any Others Yet)</title>
        <search>
          <query>index=main source="/var/log/auth.log" 
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process_Name&gt;\w+).*\:\s(?&lt;Authentication_Result&gt;\w.+)\sfor(?&lt;Reason&gt;.*)\s(?&lt;User_Name&gt;\w+)\sfrom\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sport\s(?&lt;Source_Port&gt;\d{1,6})\s(?&lt;Proc&gt;\w+)"
| stats count as total by Source_IP, host, User_Name, Process_Name
| where total&gt;100
| sort by -total</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>SSH Brute Force by Auth Logs</title>
      <chart>
        <search>
          <query>index=main source="/var/log/auth.log" 
| rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process_Name&gt;\w+).*\:\s(?&lt;Authentication_Result&gt;\w.+)\sfor(?&lt;Reason&gt;.*)\s(?&lt;User_Name&gt;\w+)\sfrom\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sport\s(?&lt;Source_Port&gt;\d{1,6})\s(?&lt;Proc&gt;\w+)"
| where Proc="ssh2"
| timechart count(User_Name) by User_Name
| append 
    [search index=main source="/var/log/auth.log" 
    | rex field=_raw "\w{3}\s\d{2}\s\d{2}:\d{2}:\d{2}\s(?&lt;Host_Name&gt;\w+)\s(?&lt;Process_Name&gt;\w+).*\:\s(?&lt;Authentication_Result&gt;\w.+)\sfor(?&lt;Reason&gt;.*)\s(?&lt;User_Name&gt;\w+)\sfrom\s(?&lt;Source_IP&gt;\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})\sport\s(?&lt;Source_Port&gt;\d{1,6})\s(?&lt;Proc&gt;\w+)"
    | where Proc="ssh2"
    | timechart count by Source_IP]</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisY2.enabled">1</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.overlayFields">192.168.150.12,10.25.100.110</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Web Scanners by Volume</title>
      <table>
        <search>
          <query>index=main source="/var/log/*access.log*" NOT("*Splunk Website Monitoring*")
| rex field=_raw "(?&lt;Source_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).*\]\s\"(?&lt;HTTP_Request_Method&gt;\w+)\s(?&lt;HTTP_Request_Path&gt;.+)\sHTTP\/1\.1\"\s(?&lt;HTTP_Response_Code&gt;\d{3}).+\"(?&lt;HTTP_Request&gt;.*)\"\s\"(?&lt;User_Agent&gt;\w.*)\""
| stats count as num_total by Source_IP,host
| where num_total&gt;1000</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
      </table>
    </panel>
    <panel>
      <title>Web Scanners by User Agent</title>
      <table>
        <title>(nmap, openVas, nikto, nessus, dirb, burp)</title>
        <search>
          <query>index=main source="/var/log/*access.log*" NOT("*Splunk Website Monitoring*")
| rex field=_raw "(?&lt;Client_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).*\]\s\"(?&lt;HTTP_Request_Method&gt;\w+)\s(?&lt;HTTP_Request_Path&gt;.+)\sHTTP\/1\.1\"\s(?&lt;HTTP_Response_Code&gt;\d{3}).+\"(?&lt;HTTP_Request&gt;.*)\"\s\"(?&lt;User_Agent&gt;\w.*)\""
| search User_Agent="*nmap*" OR User_Agent="*nikto*" OR User_Agent="*dirb*" OR User_Agent="*burp*" OR User_Agent="*nessus*" OR User_Agent="*openvas*"
| stats count as num_total by Client_IP,host,User_Agent</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel>
      <title>Web Scanners by Path Enum</title>
      <table>
        <title>(e.g. Dirb)</title>
        <search>
          <query>index=main source="/var/log/*access.log*" NOT("*Splunk Website Monitoring*")
| rex field=_raw "(?&lt;Source_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}).*\]\s\"(?&lt;HTTP_Request_Method&gt;\w+)\s(?&lt;HTTP_Request_Path&gt;.+)\sHTTP\/1\.1\"\s(?&lt;HTTP_Response_Code&gt;\d{3}).+\"(?&lt;HTTP_Request&gt;.*)\"\s\"(?&lt;User_Agent&gt;\w.*)\""
| stats dc(HTTP_Request_Path) as num_path by Source_IP,host
| where num_path&gt;100</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>

<!-- SOURCE: ANNA ANDLER (c) 2023 | kogatana-x -->